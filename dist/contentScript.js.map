{"version":3,"file":"contentScript.js","mappings":";;;;;;AAAa;AACb;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,iBAAiB;AACjB;AACA;AACA,iDAAiD,OAAO;AACxD;AACA;AACA,SAAS;AACT;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,aAAa;AACb;AACA;AACA;AACA;AACA;AACA;AACA;AACA,aAAa;AACb;AACA;AACA,KAAK;AACL;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,KAAK;AACL;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,SAAS;AACT;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,aAAa;AACb;AACA;AACA;AACA;AACA;AACA;AACA;AACA,SAAS;AACT;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,qDAAqD;AACrD;AACA;AACA;AACA;AACA,KAAK;AACL,sCAAsC,gCAAgC;AACtE;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,aAAa,QAAQ;AACrB;AACA;AACA,aAAa,UAAU;AACvB;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,aAAa,QAAQ;AACrB;AACA;AACA,aAAa,UAAU;AACvB;AACA;AACA,CAAC","sources":["webpack://hockeynation/./src/contentScript.ts"],"sourcesContent":["\"use strict\";\nconst calculateOVR = (stats) => {\n    const statsValues = Object.keys(stats).map((key) => stats[key]);\n    const sum = statsValues.reduce((acc, stat) => acc + stat.rating, 0);\n    const avg = sum / statsValues.length;\n    let excess = 0;\n    for (const stat of statsValues) {\n        if (stat.rating > avg) {\n            excess += stat.rating - avg;\n        }\n    }\n    const correctedSum = sum + excess;\n    const correctedAverage = correctedSum / statsValues.length;\n    const ovr = Math.round(correctedAverage * 10);\n    return ovr;\n};\nconst parseStatsTable = () => {\n    const puck = document.querySelector(\"svg.fa-hockey-puck\");\n    if (!puck) {\n        return false;\n    }\n    let ancestor = puck.parentElement;\n    while (ancestor && !ancestor.matches(\"table[data-v-a81c915e]\")) {\n        ancestor = ancestor.parentElement;\n    }\n    const statsTable = ancestor;\n    if (!statsTable) {\n        return false;\n    }\n    const divs = document.querySelectorAll(\"div.card-header\");\n    const ovrElement = document.querySelector(\"div.polygon.select-none text\");\n    const baseOVR = ovrElement ? ovrElement.textContent : null;\n    const updateOVR = (ovr) => {\n        var _a;\n        const ovrElement = document.querySelector(\"div.polygon.select-none text\");\n        if (ovrElement) {\n            ovrElement.textContent = ovr.toString();\n            const polygonElement = (_a = ovrElement.parentElement) === null || _a === void 0 ? void 0 : _a.querySelector(\"polygon\");\n            if (polygonElement) {\n                let fillColor = \"\";\n                if (ovr <= 39) {\n                    fillColor = \"#f56565\";\n                }\n                else if (ovr >= 40 && ovr <= 54) {\n                    fillColor = \"#ed8936\";\n                }\n                else if (ovr >= 55 && ovr <= 69) {\n                    fillColor = \"#1995AD\";\n                }\n                else if (ovr >= 70 && ovr <= 79) {\n                    fillColor = \"#10b981\";\n                }\n                else if (ovr >= 80) {\n                    fillColor = \"#383839\";\n                }\n                polygonElement.setAttribute(\"fill\", fillColor);\n            }\n        }\n    };\n    const updateHockeyPucks = (option) => {\n        statsRows.forEach((row) => {\n            var _a, _b;\n            const statName = ((_b = (_a = row.cells[0]) === null || _a === void 0 ? void 0 : _a.textContent) === null || _b === void 0 ? void 0 : _b.trim()) || \"\";\n            const pucksCell = row.cells[1];\n            const pucks = pucksCell.querySelectorAll(\"svg.fa-hockey-puck\");\n            const ratingCell = row.cells[2];\n            const ratingSpan = ratingCell === null || ratingCell === void 0 ? void 0 : ratingCell.querySelector(\"span\");\n            const stat = stats[statName];\n            if (stat) {\n                let rating = stat.rating;\n                if (option === \"Min\") {\n                    rating = minStats[statName].rating;\n                }\n                else if (option === \"Max\") {\n                    rating = maxStats[statName].rating;\n                }\n                pucks.forEach((puck, index) => {\n                    puck.classList.remove(\"text-blue-400\");\n                    if (index < rating) {\n                        puck.classList.remove(\"text-gray-300\");\n                        if (index >= stat.rating) {\n                            puck.classList.add(\"text-blue-400\");\n                        }\n                    }\n                    else {\n                        puck.classList.add(\"text-gray-300\");\n                    }\n                    if (index === rating - 1 && stat.hasRedPuck) {\n                        puck.classList.add(\"max-level\");\n                    }\n                    else {\n                        puck.classList.remove(\"max-level\");\n                    }\n                });\n                // update the rating value in the span element\n                if (ratingSpan) {\n                    ratingSpan.textContent = `(${rating})`;\n                }\n            }\n        });\n        let ovr = calculateOVR(stats);\n        if (option === \"Min\") {\n            ovr = calculateOVR(minStats);\n        }\n        else if (option === \"Max\") {\n            ovr = calculateOVR(maxStats);\n        }\n        if (option !== \"Default\" || !scoutPlayer) {\n            updateOVR(ovr);\n        }\n        else {\n            updateOVR(baseOVR !== null ? parseInt(baseOVR) : ovr);\n        }\n    };\n    divs.forEach((div) => {\n        if (div.textContent && div.textContent.trim() === \"Skills\") {\n            const dropdown = document.createElement(\"select\");\n            dropdown.classList.add(\"stats-dropdown\");\n            dropdown.style.marginLeft = \"auto\";\n            dropdown.style.fontSize = \"12px\";\n            dropdown.style.padding = \"2px\";\n            dropdown.style.border = \"none\";\n            dropdown.style.backgroundColor = \"#fff\";\n            dropdown.style.color = \"#000\";\n            dropdown.style.width = \"85px\";\n            dropdown.style.height = \"18px\";\n            dropdown.style.lineHeight = \"18px\";\n            dropdown.style.paddingTop = \"0px\";\n            dropdown.style.paddingBottom = \"0px\";\n            dropdown.style.paddingRight = \"21px\";\n            dropdown.style.borderRadius = \"2px\";\n            dropdown.addEventListener(\"change\", (event) => {\n                const selectElement = event.target;\n                const selectedOption = selectElement.value;\n                updateHockeyPucks(selectedOption);\n            });\n            const options = [\"Default\", \"Min\", \"Max\"];\n            options.forEach((option) => {\n                const optionElement = document.createElement(\"option\");\n                optionElement.value = option;\n                optionElement.textContent = option;\n                optionElement.style.textAlign = \"center\";\n                dropdown.appendChild(optionElement);\n            });\n            div.appendChild(dropdown);\n        }\n    });\n    const statsRows = statsTable.querySelectorAll(\"tbody tr\");\n    if (!statsRows.length) {\n        return false;\n    }\n    const stats = {};\n    let scoutPlayer = false;\n    statsRows.forEach((row) => {\n        var _a, _b, _c, _d;\n        const statName = ((_b = (_a = row.cells[0]) === null || _a === void 0 ? void 0 : _a.textContent) === null || _b === void 0 ? void 0 : _b.trim()) || \"\";\n        const pucks = row.querySelectorAll(\"svg.fa-hockey-puck\");\n        const ratingText = (_d = (_c = row.cells[row.cells.length - 1]) === null || _c === void 0 ? void 0 : _c.textContent) === null || _d === void 0 ? void 0 : _d.trim();\n        const ratingMatch = ratingText ? ratingText.match(/\\((\\d+)\\)/) : null;\n        if (!scoutPlayer && !ratingMatch) {\n            scoutPlayer = true;\n        }\n        const rating = ratingMatch ? parseInt(ratingMatch[1], 10) : 0;\n        const hasRedPuck = Array.from(pucks).some((puck) => puck.classList.contains(\"max-level\"));\n        stats[statName] = {\n            rating,\n            hasRedPuck,\n            strength: null,\n        };\n    });\n    const talentContainer = document.querySelector(\"body\");\n    if (talentContainer) {\n        const talentText = talentContainer.textContent || \"\";\n        const strongestMatch = talentText.match(/Strongest talents of .+ are (\\w+ and \\w+)/);\n        const weakestMatch = talentText.match(/weakest talent is (\\w+)/);\n        const strongestTalents = strongestMatch\n            ? strongestMatch[1].split(\" and \")\n            : [];\n        const weakestTalent = weakestMatch ? weakestMatch[1] : \"\";\n        strongestTalents.forEach((talent) => {\n            if (stats[talent]) {\n                stats[talent].strength = \"strongest\";\n            }\n        });\n        if (weakestTalent && stats[weakestTalent]) {\n            stats[weakestTalent].strength = \"weakest\";\n        }\n    }\n    const minStats = JSON.parse(JSON.stringify(stats));\n    let weakestRating = 10;\n    let highestNonStrongestRating = 0;\n    // find the weakest rating\n    for (const key of Object.keys(minStats)) {\n        const stat = minStats[key];\n        if (stat.strength === \"weakest\") {\n            weakestRating = stat.rating;\n        }\n    }\n    // update ratings and find the highest non-strongest rating\n    for (const key of Object.keys(minStats)) {\n        const stat = minStats[key];\n        minStats[key].rating = stat.hasRedPuck ? stat.rating : stat.rating + 1;\n        if (stat.strength !== \"strongest\") {\n            highestNonStrongestRating = Math.max(highestNonStrongestRating, minStats[key].rating);\n        }\n    }\n    // adjust strongest stats\n    for (const key of Object.keys(minStats)) {\n        const stat = minStats[key];\n        if (stat.strength === \"strongest\" &&\n            stat.rating < highestNonStrongestRating) {\n            minStats[key].rating = highestNonStrongestRating;\n        }\n    }\n    // adjust weakest stats\n    for (const key of Object.keys(minStats)) {\n        if (minStats[key].rating < weakestRating) {\n            minStats[key].rating = weakestRating;\n        }\n        if (minStats[key].rating < 4) {\n            minStats[key].rating = 4;\n        }\n    }\n    const maxStats = JSON.parse(JSON.stringify(stats));\n    let strongestRating = 10;\n    let lowestNonWeakestRating = 10;\n    // find the strongest rating\n    for (const key of Object.keys(maxStats)) {\n        const stat = maxStats[key];\n        if (stat.strength === \"strongest\") {\n            strongestRating = Math.min(strongestRating, stat.hasRedPuck ? stat.rating : 10);\n        }\n    }\n    // update ratings and find the lowest non-weakest rating\n    for (const key of Object.keys(maxStats)) {\n        const stat = maxStats[key];\n        if (!stat.hasRedPuck && stat.rating < strongestRating) {\n            maxStats[key].rating = strongestRating;\n        }\n        if (stat.strength !== \"weakest\") {\n            lowestNonWeakestRating = Math.min(lowestNonWeakestRating, maxStats[key].rating);\n        }\n    }\n    // adjust strongest stats\n    for (const key of Object.keys(maxStats)) {\n        const stat = maxStats[key];\n        if (stat.strength === \"strongest\" && !stat.hasRedPuck && stat.rating < 10) {\n            maxStats[key].rating = 10;\n        }\n    }\n    // adjust weakest stats\n    for (const key of Object.keys(maxStats)) {\n        const stat = maxStats[key];\n        if (stat.strength === \"weakest\" && stat.rating > lowestNonWeakestRating) {\n            maxStats[key].rating = lowestNonWeakestRating;\n        }\n        if (maxStats[key].rating < 4) {\n            maxStats[key].rating = 4;\n        }\n    }\n    updateHockeyPucks(\"Default\");\n    return true;\n};\nconst getStatsForPosition = (position) => {\n    const firstPosition = position.split(\"/\")[0];\n    if (firstPosition === \"G\") {\n        return [\"REF\", \"END\", \"POS\", \"PAD\", \"GLO\", \"BLO\", \"STK\"];\n    }\n    else if (firstPosition === \"LD\" || firstPosition === \"RD\") {\n        return [\"SKA\", \"END\", \"PWR\", \"SHO\", \"PAS\", \"DEF\", \"CHK\", \"DSC\"];\n    }\n    else {\n        return [\"SKA\", \"END\", \"PWR\", \"SHO\", \"PAS\", \"DEF\", \"CHK\", \"DSC\", \"FOF\"];\n    }\n};\nconst parseDraftTable = () => {\n    const infoButton = document.querySelector('button:has(svg[data-icon=\"table-cells\"])');\n    if (!infoButton) {\n        return false;\n    }\n    infoButton.click();\n    let players = [];\n    function findTargetGrid() {\n        return document.querySelector(\".grid.grid-cols-2.gap-x-2\");\n    }\n    function findSelectAllLabel() {\n        return document.querySelector('label[for=\"all\"]');\n    }\n    function findUpdateButton() {\n        return document.querySelector(\"button.btn.btn-blue.flex-grow\");\n    }\n    function extractPlayers() {\n        const rows = document.querySelectorAll(\"tbody[data-v-e2e20c3e] tr\");\n        players = Array.from(rows).map((row) => {\n            var _a, _b, _c, _d, _e;\n            const cells = row.querySelectorAll(\"td\");\n            const id = row.id;\n            const nameElement = cells[1].querySelector(\"a.text-link-primary span.lg\\\\:inline-block\");\n            const name = nameElement ? ((_a = nameElement.textContent) === null || _a === void 0 ? void 0 : _a.trim()) || \"\" : \"\";\n            const positionElement = cells[1].querySelector(\"span.text-gray-600.tracking-tighter span\");\n            const position = positionElement\n                ? ((_b = positionElement.textContent) === null || _b === void 0 ? void 0 : _b.trim()) || \"\"\n                : \"\";\n            const ovrElement = cells[6].querySelector(\"span\");\n            let ovr = null;\n            if (ovrElement) {\n                const ovrText = (_c = ovrElement.textContent) === null || _c === void 0 ? void 0 : _c.trim();\n                ovr = ovrText === \"-\" ? null : parseInt(ovrText || \"0\", 10);\n            }\n            const strengthsElement = cells[3].querySelector(\"span\");\n            const weaknessElement = cells[4].querySelector(\"span\");\n            const strengthsText = strengthsElement\n                ? ((_d = strengthsElement.textContent) === null || _d === void 0 ? void 0 : _d.trim()) || \"\"\n                : \"\";\n            const weaknessText = weaknessElement\n                ? ((_e = weaknessElement.textContent) === null || _e === void 0 ? void 0 : _e.trim()) || \"\"\n                : \"\";\n            const statMap = {\n                Skating: \"SKA\",\n                Endurance: \"END\",\n                Power: \"PWR\",\n                Shooting: \"SHO\",\n                Passing: \"PAS\",\n                Defending: \"DEF\",\n                Checking: \"CHK\",\n                Discipline: \"DSC\",\n                Faceoffs: \"FOF\",\n                Reflexes: \"REF\",\n                Positioning: \"POS\",\n                Pads: \"PAD\",\n                Glove: \"GLO\",\n                Blocker: \"BLO\",\n                Stick: \"STK\",\n            };\n            const strengths = strengthsText\n                .split(\"|\")\n                .map((s) => statMap[s.trim()])\n                .filter(Boolean);\n            const weakness = statMap[weaknessText.trim()] || \"\";\n            const statsToTrack = getStatsForPosition(position);\n            const stats = {};\n            statsToTrack.forEach((stat) => {\n                var _a;\n                let cellIndex;\n                switch (stat) {\n                    case \"SKA\":\n                        cellIndex = 18;\n                        break;\n                    case \"END\":\n                        cellIndex = 19;\n                        break;\n                    case \"PWR\":\n                        cellIndex = 20;\n                        break;\n                    case \"SHO\":\n                        cellIndex = 21;\n                        break;\n                    case \"PAS\":\n                        cellIndex = 22;\n                        break;\n                    case \"DEF\":\n                        cellIndex = 23;\n                        break;\n                    case \"CHK\":\n                        cellIndex = 24;\n                        break;\n                    case \"DSC\":\n                        cellIndex = 25;\n                        break;\n                    case \"FOF\":\n                        cellIndex = 26;\n                        break;\n                    case \"REF\":\n                        cellIndex = 27;\n                        break;\n                    case \"POS\":\n                        cellIndex = 28;\n                        break;\n                    case \"PAD\":\n                        cellIndex = 29;\n                        break;\n                    case \"GLO\":\n                        cellIndex = 30;\n                        break;\n                    case \"BLO\":\n                        cellIndex = 31;\n                        break;\n                    case \"STK\":\n                        cellIndex = 32;\n                        break;\n                    default:\n                        cellIndex = -1;\n                }\n                if (cellIndex !== -1 && cellIndex < cells.length) {\n                    const statElement = cells[cellIndex].querySelector(\"span\");\n                    if (statElement) {\n                        const ratingText = ((_a = statElement.textContent) === null || _a === void 0 ? void 0 : _a.trim()) || \"\";\n                        const rating = ratingText === \"-\" ? 0 : parseInt(ratingText, 10);\n                        const hasRedPuck = statElement.classList.contains(\"maxed\");\n                        stats[stat] = {\n                            rating,\n                            hasRedPuck,\n                            strength: strengths.indexOf(stat) !== -1\n                                ? \"strongest\"\n                                : stat === weakness\n                                    ? \"weakest\"\n                                    : null,\n                        };\n                    }\n                }\n                if (!stats[stat]) {\n                    stats[stat] = {\n                        rating: 0,\n                        hasRedPuck: false,\n                        strength: null,\n                    };\n                }\n            });\n            return {\n                id,\n                name,\n                position,\n                ovr,\n                stats,\n            };\n        });\n        console.log(\"Extracted players:\", players);\n    }\n    const observer = new MutationObserver((mutations) => {\n        for (let mutation of mutations) {\n            if (mutation.type === \"childList\") {\n                const targetGrid = findTargetGrid();\n                if (targetGrid) {\n                    observer.disconnect();\n                    const selectAllLabel = findSelectAllLabel();\n                    if (selectAllLabel) {\n                        const checkbox = document.getElementById(\"all\");\n                        if (checkbox && !checkbox.checked) {\n                            selectAllLabel.click();\n                        }\n                    }\n                    const updateButton = findUpdateButton();\n                    if (updateButton) {\n                        updateButton.click();\n                    }\n                    // Extract players after updating\n                    setTimeout(extractPlayers, 500); // Small delay to ensure table is updated\n                    return;\n                }\n            }\n        }\n    });\n    observer.observe(document.body, { childList: true, subtree: true });\n    return true;\n};\n// process user preference data here\nconst resetUserPreferences = (userPreferences) => {\n    if (userPreferences) {\n        // process data here\n        console.log(\"Processing user preferences:\", userPreferences);\n    }\n    else {\n        return;\n    }\n};\nchrome.runtime.onMessage.addListener((message, sender, sendResponse) => {\n    if (message.action === \"parseStatsTable\") {\n        if (!parseStatsTable()) {\n            const interval = setInterval(() => {\n                if (parseStatsTable()) {\n                    clearInterval(interval);\n                }\n            }, 100); // 0.1 Seconds\n            setTimeout(() => {\n                clearInterval(interval);\n            }, 10000); // 10 Seconds\n        }\n    }\n    else if (message.action === \"parseDraftTable\") {\n        if (!parseDraftTable()) {\n            const interval = setInterval(() => {\n                if (parseDraftTable()) {\n                    clearInterval(interval);\n                }\n            }, 100); // 0.1 Seconds\n            setTimeout(() => {\n                clearInterval(interval);\n            }, 10000); // 10 Seconds\n        }\n    }\n});\n"],"names":[],"sourceRoot":""}